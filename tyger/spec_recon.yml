# h5 file to stream as command, stream pipe to output
# ismrmrd_hdf5_to_stream -i testdata.h5 --use-stdout \
# | tyger run exec -f  basic_gadgetron.yml \
# | ismrmrd_stream_to_hdf5 --use-stdin -o out_basic.h5

# Start a bash shell in the tyger to use unix commands
# https://microsoft.github.io/tyger/guides/runs.html
# command:
#   - "bash"
#   - "-c" 
#   - "echo "
# 
# or as args: https://docs.tyger.cloud/tyger-mri-reconstruction.html
# args:
#   - bash
#   - -c
#   - |
#     set -eu
#     ismrmrd_generate_cartesian_shepp_logan
#     ismrmrd_hdf5_to_stream -i testdata.h5 -o $OUTPUT_PIPE

# declare an anonymous codespec inline
job:
  codespec:
    image: ghcr.io/medcap/mrsrecon:v2.2
    buffers:
      inputs: ["input"]
      outputs: ["output"]
    command:
      - "bash"
      - "-c"
      - |
        set -e
        echo "DEBUG: Reconstruct mrd file..." >&2
        cat $INPUT_PIPE | python mrd2recon.py -urea 0.0 -KIC_s 8.6 -leu_tm 13.0 -hyd_tm 18.1 -?_tm 21.8 -w 1.5 > $OUTPUT_PIPE
        echo "DEBUG: Reconstruction complete" >&2

  # cat $INPUT_PIPE | python readmrd.py  > $OUTPUT_PIPE
  # echo "DEBUG: Reconstruction complete" >&2


  
# name: mrs_reconstruction
# image: ghcr.io/medcap/mrsrecon:v2
# buffers:
#   inputs: ["input"]
#   outputs: ["output"]
# command:
#   - bash
#   - -c
#   - |
#     set -eu
#     cat $INPUT_PIPE | python mrd2recon.py -bic_tm 0.0 -urea 2.3 -pyr_s 9.7 -ala_tm 15.2 -poop_tm 15.9 -hyd_tm 18.1 -lac_m 21.8 > $OUTPUT_PIPE